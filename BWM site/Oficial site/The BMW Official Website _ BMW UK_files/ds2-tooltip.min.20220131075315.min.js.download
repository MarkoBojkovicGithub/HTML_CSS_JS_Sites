define("ds2-tracking-tooltip",["jquery","ds2-tracking-base","ds2-tracking"],function(d,l,h){d.widget("digitals2.ds2TrackingTooltip",l,{_create:function(){var a=this._super(),f=this,e=f.element[0];d(e).on("click",function(c){var b=d(e),a=f._getTrackOptionsData(b),g=f._getTrackingEventData(b);a&&g||(b=b.closest(".ds2-tracking-tooltip--event"),0===b.length&&(b=d(e).find("[data-tracking-event]")),0<b.length&&(c.currentTarget=b,f.options.$element=b,a=f._getTrackOptionsData(b),g=f._getTrackingEventData(b)));
a&&g&&(a=f.bmwTrackOptionsBuilder.options().name(g.eventInfo.track||a.name||"").build(),window&&window.location&&(g.eventInfo.target=window.location.href),b=f._populateClickEvent(c,a.name,g.eventInfo.target,g.eventInfo.eventName,g.eventInfo.cause,g.eventInfo.effect),b.eventInfo.eventAction="Open Tooltip",f._parseDataFromEvent(b,a,c,!0));c.stopPropagation()});return a},_register:function(){var a=this._getTrackingComponent(),d=this.api.getPageObject(this.api.getCurrentPageIndex());if(d&&a&&d.component&&
0<d.component.length)for(var e=!1,c=0;c<d.component.length;c++)if(d.component[c].componentInfo&&a.componentInfo&&d.component[c].componentInfo.componentID==a.componentInfo.componentID){e=!0;break}e||this._super()},_getTrackingEventData:function(a){return d(a).data("tracking-event")||null},_getTrackOptionsData:function(a){return d(a).data("tracking-options")||null}});return function(a){a.ds2TrackingTooltip(h.getOptions("ds2-tooltip"))}});
define("ds2-tooltip-accessibility",["jquery","ds2-accessibility"],function(d,l){function h(a){this.$tooltipTrigger=d(a);this.accessibility=new l(a);this.selectors={tooltip:".ds2-tooltip-element",tooltipBody:".ds2-tooltip-element--body",closeButton:".ds2-tooltip-element--close-button",withTooltipId:function(a){return'[data-qtip-id\x3d"'+a+'"]'}};this.addKeyboardSupportForTooltip();this.addScreenReaderSupportForTooltip()}h.prototype.addKeyboardSupportForTooltip=function(){var a=this;if(this.$tooltipTrigger.is("button"))this.$tooltipTrigger.on("click",
function(){setTimeout(a.initTooltip(a),300)});else{var d={element:this.$tooltipTrigger,keyCodes:[this.accessibility.keyCodes.ENTER],fn:this.createKeyHandlerForTooltipTrigger(this)};this.accessibility.addKeyListener("down",d)}};h.prototype.createKeyHandlerForTooltipTrigger=function(a){return function(){a.$tooltipTrigger.click();setTimeout(a.initTooltip(a),300)}};h.prototype.initTooltip=function(a){return function(){if(!a.$tooltipContainer){var f=a.$tooltipTrigger.data("hasqtip");a.$tooltipContainer=
d(a.selectors.withTooltipId(f));a.$tooltip=a.$tooltipContainer.find(a.selectors.tooltip);a.$tooltipBody=a.$tooltip.find(a.selectors.tooltipBody);a.$closeButton=a.$tooltipContainer.find(a.selectors.closeButton);a.addListenersToTooltip(a);a.initTooltipStyles(a);a.accessibility.setAriaAttribute("describedby",a.$tooltipTrigger);a.accessibility.setAriaAttribute("describedby",a.$tooltipContainer);f="tooltip-body-"+f;a.$tooltipBody.attr("id",f);a.accessibility.normalizeModalDialogForScreenReaders({container:a.$tooltipContainer,
ariaLabelledBy:f,ariaLive:"off"})}setTimeout(function(){a.accessibility.focusFirstFocusableChild(a.$tooltipContainer)},300)}};h.prototype.addListenersToTooltip=function(a){0!==a.$closeButton.length&&(a.accessibility.addKeyListener("up",{element:a.$tooltipContainer,keyCodes:[a.accessibility.keyCodes.ESC],fn:function(){a.$closeButton.click()}}),a.$closeButton.on("click",function(){a.$tooltipTrigger.focus()}),a.accessibility.activateKeyboardTrap({container:a.$tooltipContainer,includeContainer:!1}))};
h.prototype.addScreenReaderSupportForTooltip=function(){var a=this;this.$tooltipTrigger.on("click tap",function(){setTimeout(a.initTooltip(a),300)});this.setEfficiencyCategoryForAriaLabel()};h.prototype.setEfficiencyCategoryForAriaLabel=function(){var a=this.$tooltipTrigger.data("efficiency-category");a&&(a={AAA:"A++",AA:"A+",A:"A",B:"B",C:"C",D:"D",E:"E",F:"F",G:"G",H:"H",I:"I"}[a.trim().toUpperCase()],a=this.$tooltipTrigger.attr("aria-label").replace("{0}",a),this.$tooltipTrigger.attr("aria-label",
a))};h.prototype.initTooltipStyles=function(a){a.$tooltip.addClass("ds2-accessibility")};return h});
define("ds2-tooltip","jquery ds2-scroll ds2-tooltip-accessibility ds2-tracking-checker jquery-qtip ds2-resize-events".split(" "),function(d,l,h,a){var f=function(c){var b=this;b.options={topOffset:16,topOffsetMobileTablet:28,bottomOffset:0,bottomOffsetMobileTablet:8};b.$element=d(c);c=b._findShadowRoot(c);b.$context=c?d(c.firstElementChild):d(document.body);b.tooltipId=b.$element.data("tooltip-id");b.$tooltip=d('.ds2-tooltip-element[data-id\x3d"'+b.tooltipId+'"]',b.$context);b._body=d("body");d("html").hasClass("touch")&&
(b.options.topOffset=b.options.topOffsetMobileTablet,b.options.bottomOffset=b.options.bottomOffsetMobileTablet);b.options.dynamicTopOffset=parseInt(b.$element.css("line-height"))||b.options.topOffset;b.iscroll;b.lastPosition="";b._checkForFullscreen();b._setDeviceValues();b._initTooltips();d(window.digitals2.resizeEvents).on("ds2ResizeSmall ds2ResizeMedium ds2ResizeLarge",b,b._onResize);a.isDigitals2TrackingAvailable()&&require(["ds2-tracking-tooltip"],function(c){c(b.$element)});b.accessibility=
new h(b.$element)},e=f.prototype;e._findShadowRoot=function(c){return c instanceof ShadowRoot?c:c.parentNode?this._findShadowRoot(c.parentNode):null};e._setDeviceValues=function(){switch(window.digitals2.resizeEvents.mediaQueryWatcherCheck()){case "ds2ResizeSmall":this.isMobile=!0;this.isTablet=!1;this.fullscreenMode=!0;break;case "ds2ResizeMedium":521>=d(window).height()?(this.isMobile=!0,this.isTablet=!1,this.fullscreenMode=!0):(this.isTablet=!0,this.fullscreenMode=this.isMobile=!1);break;default:this.fullscreenMode=
this.isTablet=this.isMobile=!1}};e._initTooltips=function(){var c=this,b=this.options,a=this.$element,g=this.$tooltip,f=this.$context,e=a.data("position"),k=g.data("open-default"),h=!1,n=a.data("open-onclick"),m=d(".ds2-icon",a).data("tooltip-type"),p=a.data("set-container"),l="top-center"===e?0:10;p="top-center"===e?1==p?d(window):"":d(window);var x=-1<c.tooltipId.indexOf("plcPrice"),y=-1<c.tooltipId.indexOf("tooltip-needanalyzer"),z=-1<c.tooltipId.indexOf("tooltip-dynamic");m||(m=a.data("tooltipType"));
c._isOnLayer()&&(e="layer");switch(e){case "top-center":e="bottom center";var q="top center";var r=b.bottomOffset;break;case "layer":e="left center";q="right center";var t=r=0;break;default:switch(m){case "spotlight":e="center left";q="center right";r=b.bottomOffset;break;case "needanalyzer-sharing-medium-down":e="bottom right";q="top right";r=14;l=-15;t=15;break;case "needanalyzer-sharing-large":e="left top";q="right top";r=40;t=35;break;default:e="left top",q="right top",r=b.dynamicTopOffset}}b=
{solo:!0,ready:h};var u={event:!1};if(x||y||z)u={event:"unfocus",fixed:!0,delay:300};k&&(h=!0,u={event:"click"});if(n||c.fullscreenMode)b={solo:!0,event:"click",ready:h};c.content=g;if(!("spotlight"===m||c.isTablet&&c.isMobile)){var v=!1;a.qtip({overwrite:!0,content:{text:g[0]},style:{tip:{corner:!0,width:20,height:10,offset:t}},position:{container:f,viewport:p,my:e,at:q,adjust:{y:r,x:l}},show:b,hide:u,events:{show:function(a,b){d("[data-qtip-id\x3d'"+b.id+"']",f).css("display","block");d("[data-qtip-id\x3d'"+
b.id+"']",f).addClass("qtip-fadeIn");c.$element.addClass("ds2-tooltip--open")},move:function(a,b){v?setTimeout(function(){v=!1},1E3):(v=!0,a=b.position.my.x+"_"+b.position.my.y,c.lastPosition!==a&&(c.lastPosition=a,c._repositionTooltipCorner(a)))},hide:function(b,g){a.qtip("option","show.ready",!1);a.qtip("option","hide.fixed",!0);a.qtip("option","hide.delay",300);c._body.removeClass("no-scroll");d("[data-qtip-id\x3d'"+g.id+"']",f).css("display","");d("[data-qtip-id\x3d'"+g.id+"']",f).removeClass("qtip-fadeIn");
a.removeClass("ds2-tooltip--open")},visible:function(a,b){c._checkForFullscreen();c._buildFullSize(c.$tooltip,c.fullscreenMode);c.scrollBar.setBarPosition()}}})}d(".ds2-tooltip-element--close a, .qtip-close, .ds2-tooltip-element--close-button",c.content).off().on("click",a,c._onCloseClick);c.$element[0].addEventListener("ds2-tooltip--close",function(){c.$element.qtip("hide")},!1)};e._onCloseClick=function(a){var b=a.data;a.preventDefault();b.qtip("hide")};e._onResize=function(a){a=a.data;var b=a.$element,
c=a.$tooltip,g=b.data("tooltip-type"),e="plcPrice-carview-"===a.tooltipId&&!d(".ds2-ols-finance--car-view.ds2-ols-finance--dropdown_expanded").length;a._setDeviceValues();a._checkForFullscreen();"spotlight"===g||e&&(a.isTablet||a.isMobile)?b.qtip("hide"):a._buildFullSize(c,a.fullscreenMode);"needanalyzer-sharing-large"===g&&(a.isTablet||a.isMobile)&&d('.ds2-tooltip[data-tooltip-type\x3d"needanalyzer-sharing-large"]').qtip("hide");"needanalyzer-sharing-medium-down"!==g||a.isTablet||a.isMobile||d('.ds2-tooltip[data-tooltip-type\x3d"needanalyzer-sharing-medium-down"]').qtip("hide");
a.fullscreenMode&&c.closest(".qtip").hasClass("qtip-focus")?a._body.addClass("no-scroll"):c.closest(".qtip").hasClass("qtip-focus")&&(a._body.removeClass("no-scroll"),b.qtip("reposition"))};e._buildFullSize=function(a,b){var c=this,g=d(".ds2-tooltip-element--body",a),e=d(".ds2-tooltip-element--close",a),f=d(".ds2-tooltip-element--footer",a);document.body.contains(d("html")[0])&&d("html").offset();d(window).outerHeight();e.length&&e.outerHeight();f.length&&f.outerHeight();a.each(function(){var d=a.closest(".qtip-default");
b?(/iPhone|iPad|iPod/i.test(navigator.userAgent)&&c.isMobile?g.css("max-height","80vh"):g.css("max-height","95vh"),d.addClass("qtip-inFullscreenMode")):(g.removeAttr("style"),d.removeClass("qtip-inFullscreenMode"))})};e._isOnLayer=function(){return 0<this.$element.parents(".ds2-layer--container").length};e._repositionTooltipCorner=function(a){var b=this.options,c=this.$element,d=c.data("tooltip-type");setTimeout(function(){switch(a){case "left_top":c.qtip("option","style.tip.mimic","left center");
c.qtip("option","style.tip.offset",40);"spotlight"!==d&&c.qtip("option","position.adjust.y",b.topOffset);"infoIcon"!==d&&c.qtip("option","position.adjust.y",b.dynamicTopOffset);break;case "left_bottom":c.qtip("option","style.tip.mimic","left center");c.qtip("option","style.tip.offset",40);c.qtip("option","position.adjust.y",b.bottomOffset);break;case "right_top":c.qtip("option","style.tip.mimic","right center");"needanalyzer-sharing"!==d&&c.qtip("option","style.tip.offset",40);"spotlight"!==d&&"needanalyzer-sharing-large"!=
d&&c.qtip("option","position.adjust.y",b.topOffset);"infoIcon"!==d&&"needanalyzer-sharing-large"!=d&&c.qtip("option","position.adjust.y",b.dynamicTopOffset);"needanalyzer-sharing-large"===d&&(c.qtip("option","style.tip.offset",35),c.qtip("option","position.adjust.y",40));break;case "right_bottom":c.qtip("option","style.tip.mimic","bottom center");"needanalyzer-sharing-medium-down"===d&&(c.qtip("option","position.adjust.y",14),c.qtip("option","position.adjust.x",-15),c.qtip("option","style.tip.offset",
15));break;case "left_center":case "right_center":c.qtip("option","style.tip.mimic",!1),c.qtip("option","style.tip.offset",0)}},1)};e._createScrollBar=function(){this.scrollBar=new l(this.$tooltip[0])};e._checkForFullscreen=function(){var a=this,b=a.$element,e=a.$tooltip,f=b.data("tooltip-type"),h=b.data("position"),l=d(document).width(),k=e.width()+12+40,w=b.width();b=(b?b.offset():0).left;var n=l-w-b,m=!1,p=!1;k=410<k?410:k;"top-center"===h&&(k=e.width()/2,b+=w/2,n=l-b,b>n?p=!0:m=!0,k=205<k?205:
k);"spotlight"!==f&&"top-center"!==h&&b<=k&&n<=k?a.fullscreenMode=!0:"spotlight"!==f&&"top-center"===h&&(m&&b<=k||p&&n<=k)?a.fullscreenMode=!0:a.isMobile||(a.fullscreenMode=!1);a.iscroll&&(a.iscroll=null);setTimeout(function(){a._createScrollBar()},50)};require(["componentInitializer"],function(a){window.digitals2.tooltips={init:function(b){a.init(d(b))},initAll:function(b){a.initAll(d(b))},initElement:function(b){a.initElement(d(b))},getController:function(b,c){a.getController(d(b),c)}}});return f});