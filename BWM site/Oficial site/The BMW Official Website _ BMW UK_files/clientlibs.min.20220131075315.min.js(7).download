define("ds2-mood-preconfiguration",["business/commons/TrackingAdapter","ds2-accessibility","ds2-main","ds2-touch-detection","lazyload","swiper"],(function(e,t,n,i,o,r){return a={315:function(e,t){var n;void 0===(n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),t.default=function(e){return decodeURIComponent(e.replace(n," "))};const n=/\+/g}.apply(t,[t]))||(e.exports=n)},301:function(e,t,n){var i,o;i=[t,n(234)],void 0===(o=function(e,n){"use strict";var i;function o(e,t){let n;do{n=Object.getOwnPropertyDescriptor(e,t)}while(!n&&(e=Object.getPrototypeOf(e)));return n}Object.defineProperty(e,"__esModule",{value:!0}),t.default=function(e,t,i){let r=Array.isArray(t)?t:(0,n.default)(t);for(let t=0;t<r.length;t++){let n=r[t];const a=o(e,n);if(t===r.length-1)return a&&a.hasOwnProperty("value")?a.value:a&&a.hasOwnProperty("get")?a.get.apply(e):i;if(!a)return i;e=e[n]}return i},n=(i=n)&&i.__esModule?i:{default:i}}.apply(t,i))||(e.exports=o)},286:function(e,t,n){var i,o;i=[t,n(209),n(460),n(329),n(301)],o=function(e,n,i,o,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(e,"__esModule",{value:!0}),t.default=void 0,n=a(n),i=a(i),o=a(o),r=a(r);class d{constructor(e){if(d._instance)return d._instance;d._instance=this,this.relatedComponentData=e,this.trackingApi=new n.default,this.trackingApi.isInitialized().then((e=>{e&&this.initComponentTracking()}))}initComponentTracking(){this.trackingApi.initComponentTracking(this.relatedComponentData)}getConfigLink(e){const{conUrl:t}=window.moodPreconfiguration,{trackingData:n}=e;return"".concat(t).concat(n.internalCode,"/").concat(n.modelCode,"/").concat(n.fabric,",").concat(n.paint,",").concat(n.saCodes,"?preconfiguredModel=true")}getCosyBrand(e){return"wbbi"===e.trackingData.manufacturer.toLowerCase()?"BMWI":"BMW"}getProductObj(e){return{productInfo:{productID:"".concat(this.getCosyBrand(e),"-").concat(e.trackingData.internalCode),productName:e.trackingData.productName,manufacturer:this.getCosyBrand(e)},category:{primaryCategory:"new car",subCategory1:"bto",productType:"vehicle"},attributes:{linkedProduct:{productInfo:{productID:"na"}},internalCode:e.trackingData.internalCode,modelCode:e.trackingData.modelCode,productionYear:"na",series:"na",fuelType:"na",gearing:"na",engine:"na",color:e.trackingData.paint,vehicleSelection:"na",configID:"na",configLink:this.getConfigLink(e)}}}dispatchClickEvent(e,t){const n=window.moodPreconfiguration.items[e],i=this.getProductObj(n);this.trackingApi.initProductTracking(i);const o={eventInfo:{eventName:"interaction",eventAction:t?"external click":"internal click",eventPoints:"na",type:"ux",effect:"nsc > all mood pre-configuration details clicked",cause:"default",target:"na",element:"na"},attributes:{requestedURL:"na",errorCode:"na",linkedComponent:{componentInfo:this.relatedComponentData&&this.relatedComponentData.componentInfo.componentID},linkedPage:{pageInfo:{pageID:window.location.pathname}},linkedProduct:{productInfo:{productID:"".concat(this.getCosyBrand(n),"-").concat(n.trackingData.internalCode)}}}};this.dispatch("mood_pre_configuration_interaction",o,e)}dispatch(e,t,n){let i=parseInt(n.substring(n.length-1));const o={category:{primaryCategory:"mood pre-configuration",subCategory1:"option ".concat(i+1)}},r=this.trackingApi.createEvent(s(s({},o),t));this.trackingApi.dispatchEvent(r,e)}}((0,i.default)()||(0,o.default)())&&Object.getOwnPropertyNames(d.prototype).forEach((function(e){d.prototype[e]=function(){}}));var u=d;t.default=u}.apply(t,i),void 0===o||(e.exports=o)},664:function(e,t,n){var i,o;i=[t,n(571),n(986),n(552),n(412),n(485),n(286)],void 0===(o=function(e,n,i,o,r,a,c){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),t.default=void 0,i=s(i),o=s(o),r=s(r),a=s(a),c=s(c);const l=new business.commons.logger("bmwweb-fc","MoodPreconfiguration");function d(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)>980}function u(e){let t=0;return e.forEach((e=>{e.offsetHeight>t&&(t=e.offsetHeight)})),t}function f(e){const t=e.querySelectorAll(".ds2-mood-preconfiguration-item__price-list-layer"),n=e.querySelectorAll(".ds2-mood-preconfiguration-item__hover-content"),i=function(){let e=0;return!1===d()&&(e=85),a.default.any&&d()?10:e}();t.forEach((e=>{e.removeAttribute("style")}));const o=u(t);var r;r=o+i,t.forEach((e=>{e.setAttribute("style","height: ".concat(r,"px"))})),function(e,t){e.forEach((e=>{e.setAttribute("style","top: ".concat(t,"px"))}))}(n,o+2+i),function(e,t){const n=function(e){const t=[...e.querySelectorAll(".ds2-mood-preconfiguration-item__header")].map((e=>e.offsetHeight));return Math.max(...t)}(e);[...t].forEach((e=>Object.assign(e.style,{"margin-top":"".concat(n-50,"px")})))}(e,n)}function p(e){const t=e.querySelectorAll(".ds2-mood-preconfiguration-item__content-container"),n=e.querySelector(".ds2-mood-preconfiguration__pagination");n.classList.add("ds2-mood-preconfiguration__pagination--fade-in");const i=u(t);n.setAttribute("style","top: ".concat(i-55,"px"))}function g(){f(this),p(this)}function h(e,t){const n=e.querySelectorAll(".ds2-mood-preconfiguration-item__content-container, .ds2-mood-preconfiguration-item__button");for(let e=0,i=n.length;e<i;e+=1)n[e].setAttribute("data-tracking-linkid","".concat(window.moodPreconfiguration.items[t].trackingData.productName," mood pre-configuration details clicked"))}class m{constructor(e){this.el=e,this.items=this.el.querySelectorAll(".ds2-mood-preconfiguration-item"),this.lazyload=new i.default({container:this.el}),function(e){const t=e.querySelectorAll(".ds2-mood-preconfiguration-item__price");let n=0;for(let e=0,i=t.length;e<i;e+=1)""!==t[e].innerText&&(n+=1);if(n<1)for(let e=0,n=t.length;e<n;e+=1)t[e].classList.add("ds2-mood-preconfiguration-item__price--hide")}(this.el),this.relatedComponentData=JSON.parse(this.el.getAttribute("data-tracking-component")),function(e){const t=e.querySelectorAll(".ds2-mood-preconfiguration-item");for(let e=0,n=t.length;e<n;e+=1){const n=t[e],i=n.querySelector(".ds2-mood-preconfiguration-item__container").getAttribute("data-item-path"),o=n.getAttribute("data-modelrange-vehicle");n.setAttribute("data-tracking-regionid","mood pre-configuration > option ".concat(e+1,":").concat(o)),h(n,i)}}(this.el),this.moodPreconfigurationTracking=new c.default(this.relatedComponentData),this.accessibility=new r.default(e),this.preventFocusOnButton(),this.addItemIndex(),this.addKeyboardListener(),setTimeout((()=>{this.initSwiper(),this.el.classList.add("ds2-mood-preconfiguration--fade-in")}),100),setTimeout((()=>{f(this.el),p(this.el)}),300),this.addTouchDetection(),new ResizeObserver(g.bind(this.el)).observe(this.el),this.initializeFinanceListener()}initializeFinanceListener(){if(this.showFinance="true"===this.el.getAttribute("data-show-finance"),this.showFinance)if("loading"!==document.readyState)this.initFinance();else{const e=()=>{this.initFinance()};window.addEventListener("load",e),window.addEventListener("DOMContentLoaded",(()=>{window.removeEventListener("load",e),e()}))}}addTouchDetection(){a.default.any&&this.el.classList.add("is-touch")}preventFocusOnButton(){this.items.forEach((e=>{const t=e.querySelector(".ds2-mood-preconfiguration-item__button-link");t&&t.setAttribute("tabindex","-1")}))}addItemIndex(){this.items.forEach(((e,t)=>{e.setAttribute("data-mood-preconfiguration-item-index",t)}))}addKeyboardListener(){this.items.forEach((e=>{const t=e.querySelector(".ds2-mood-preconfiguration-item__button-link");this.accessibility.addKeyListener("up",{element:e,keyCodes:[this.accessibility.keyCodes.ENTER],fn:()=>{t.click()}}),e.addEventListener("keydown",this.keyDownHandler.bind(this))}))}initSwiper(){const e=this.el.querySelector(".swiper-pagination").dataset.ariaLabelPagination,t=void 0!==this.el.getAttribute("data-number-of-precons")?parseInt(this.el.getAttribute("data-number-of-precons"),10):3;2===t&&(this.el.querySelectorAll(".ds2-mood-preconfiguration-item__bg-image").forEach(((e,t,n)=>{e.style.height="600px"})),this.el.querySelectorAll(".ds2-mood-preconfiguration-item__button-list").forEach(((e,t,n)=>{const i=e;i.style.paddingLeft="32px",i.style.paddingRight="32px"})),this.el.querySelectorAll(".ds2-mood-preconfiguration-item__check-list").forEach(((e,t,n)=>{const i=e;i.style.paddingLeft="40px",i.style.paddingRight="40px"})),this.el.querySelectorAll(".ds2-mood-preconfiguration-item__disclaimer").forEach(((e,t,n)=>{const i=e;i.style.paddingLeft="17px",i.style.paddingRight="17px"})),this.el.querySelectorAll(".ds2-mood-preconfiguration-item__image-vehicle").forEach(((e,t,n)=>{const i=e;i.classList.add("center"),i.firstElementChild.style.marginLeft="auto",i.firstElementChild.style.marginRight="auto"}))),this.swiper=new o.default(this.el.querySelector(".swiper-container"),{speed:400,slidesPerView:t,spaceBetween:3===t?15:25,centeredSlides:!0,keyboardControl:!0,preloadImages:!1,breakpoints:{520:{slidesPerView:1,spaceBetween:5},980:{slidesPerView:2,spaceBetween:15,centeredSlides:!1}},pagination:{el:".swiper-pagination",type:"bullets",clickable:!0},a11y:{paginationBulletMessage:e}})}keyDownHandler(e){const t=e.which||e.keyCode;if(!d()&&this.accessibility.keyCodes.TAB===t){const t=m.getItemIndex(e.target);if(e.shiftKey){if(0===t)return;this.swiper.slideTo(t-1),setTimeout((()=>{this.items[t-1].focus()}),400)}else{if(2===t)return;this.swiper.slideTo(t+1),setTimeout((()=>{this.items[t+1].focus()}),400)}e.preventDefault()}}static getItemIndex(e){const t=e.getAttribute("data-mood-preconfiguration-item-index");return parseInt(t,10)}initFinance(){this.financeBundleUrl=this.el.getAttribute("data-finance-bundle-url"),this.financeHostUrl=this.el.getAttribute("data-finance-host-url"),this.currency=this.el.getAttribute("data-currency"),this.locale=document.querySelector("html").getAttribute("lang"),this.country=this.el.getAttribute("data-country");const e=this.el.querySelector(".ds2-mood-preconfiguration-item__finance-container");this.brand=null!=e?e.getAttribute("data-brand"):"bmwCar",this.language=this.locale.substring(0,this.locale.indexOf("-")),m.loadBundle(this.financeBundleUrl).then((()=>{this.province=window.consentcontroller&&window.consentcontroller.api?window.consentcontroller.api.getPersistence("prov_consentCookie"):null,this.financeConfig={tenant:{channel:"PRECON",brand:this.brand,country:this.country,province:this.province,language:this.language,priceTree:"DEFAULT",gfsPolicy:"none"},environment:{locale:this.locale,currency:this.currency,SF_HOST:this.financeHostUrl,modalContainer:this.el.querySelector(".sf-disclaimer")}};const e={channels:"PRECON",brands:this.brand,countries:this.country,provinces:this.province,languages:this.language,priceTree:"DEFAULT",gfsPolicy:"none"};document.addEventListener("SFWidgetInitEvent",(()=>{l.debug("Finance Calculator widget ready"),f(this.el),p(this.el)})),document.addEventListener("SFDataErrorEvent",(e=>{l.error("Error event reported by finance calculator component",e),this.financeError()})),document.addEventListener("SFErrorEvent",(e=>{l.error("Error event reported by finance calculator component",e),this.financeError()})),this.el.querySelectorAll(".ds2-mood-preconfiguration-item__finance-container").forEach((t=>{const n=t.querySelector("sf-calculation-widget");if(n&&"object"==typeof n.configuration){const i=(new Date).toISOString().substring(0,10),o={models:t.getAttribute("data-model-code"),modelRange:t.getAttribute("data-model-range"),gearboxCode:null,equipments:m.getEquipments(t),modelName:t.getAttribute("data-model-name"),orderDate:i,effectDate:t.getAttribute("data-effect-date")};n.configuration={tenantParams:e,configurationParams:o,environment:this.financeConfig.environment}}else l.error("Could not initialize SF calculation widget"),this.financeError()}))})).catch((e=>{l.error("Error during finance calculator bootstrap",e),this.financeError()}))}static loadBundle(e){return new Promise(((t,n)=>{const i=document.createElement("script");i.src=e,i.type="module",i.onError=n,i.async=!0,i.onload=t,i.addEventListener("error",n),i.addEventListener("load",t),document.head.appendChild(i)}))}financeError(){l.debug("Finance Error",this.financeConfig)}static getEquipments(e){const t=e.getAttribute("data-fabric"),n=e.getAttribute("data-paint"),i=e.getAttribute("data-sa-codes"),o=[];return m.pushIfNotNull(t,o),m.pushIfNotNull(n,o),m.pushIfNotNull(i,o),o.join(",").split(",")}static pushIfNotNull(e,t){e&&t.push(e)}}var y=m;t.default=y}.apply(t,i))||(e.exports=o)},423:function(e,t,n){var i,o;i=[t,n(378)],o=function(e,n){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),t.default=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window.location.search;const t=(0,n.default)(e);return t.wcmmode&&t.wcmmode.length>0?t.wcmmode[0]:window.CQ&&window.CQ.WCM?window.CQ.WCM.getMode():""},n=(i=n)&&i.__esModule?i:{default:i}}.apply(t,i),void 0===o||(e.exports=o)},329:function(e,t,n){var i,o;i=[t,n(423)],void 0===(o=function(e,n){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),t.default=function(){return"design"===(0,n.default)()},n=(i=n)&&i.__esModule?i:{default:i}}.apply(t,i))||(e.exports=o)},460:function(e,t,n){var i,o;i=[t,n(423)],void 0===(o=function(e,n){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),t.default=function(){const e=(0,n.default)();return"string"!=typeof e||"edit"===e},n=(i=n)&&i.__esModule?i:{default:i}}.apply(t,i))||(e.exports=o)},378:function(e,t,n){var i,o;i=[t,n(315)],void 0===(o=function(e,n){"use strict";var i;function o(e,t,n){const i=Array.isArray(n)?n.join(","):n,o=e;t in o?o[t].push(i):o[t]=[i]}Object.defineProperty(e,"__esModule",{value:!0}),t.default=function(e){const t={};let i=e;"?"===i.charAt(0)&&(i=i.slice(1));for(let e=i.split("&"),r=0,a=e.length;r<a;r+=1){const i=e[r],a=i.indexOf("=");a>-1?o(t,(0,n.default)(i.slice(0,a)),(0,n.default)(i.slice(a+1))):i.length&&o(t,(0,n.default)(i),!0)}return t},n=(i=n)&&i.__esModule?i:{default:i}}.apply(t,i))||(e.exports=o)},234:function(e,t){var n;void 0===(n=function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),t.default=function(e){let t=e;if(Array.isArray(t))return t;if("number"==typeof t)return[t];t=String(t);const n=[];return t.replace(/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(\.|\[\])(?:\4|$))/g,((e,t,i,o)=>{const r=void 0!==t?Number(t):e;return n.push(i?o:r),n[n.length-1]})),n}}.apply(t,[t]))||(e.exports=n)},209:function(e,t,n){var i,o;i=[t,n(613),n(301)],void 0===(o=function(e,n,i){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(e,"__esModule",{value:!0}),t.default=void 0,n=o(n),i=o(i);class r{constructor(){this.isTrackingAllowed=!1}isInitialized(){return new Promise(((e,t)=>{r.isConsentAccepted().then((()=>{n.default&&n.default.isInitialized()&&(this.isTrackingAllowed=!0,e(!0))}),(()=>{t()}))}))}static isConsentAccepted(){return new Promise(((e,t)=>{(0,i.default)(window,"consentcontroller.api.isInitialized")?!1===window.consentcontroller.api.isInitialized()?window.consentcontroller.api.isRegulationAccepted()?e():t():window.consentcontroller.api.registerOnInitialized((()=>{window.consentcontroller.api.isRegulationAccepted()?e():t()})):t()}))}createEvent(e){if(!this.isTrackingAllowed)return{};const t=r.newEvent(e).build();return delete t.attributes.relatedPageName,delete t.attributes.relatedPageCategory,delete t.attributes.relatedComponent,delete t.category.mmdr,delete t.category.eventType,t}dispatchEvent(e,t){if(!this.isTrackingAllowed)return;const i=n.default.buildOptions(t);n.default.trackEvent(e,{},i)}static newEvent(e){return n.default.getEventBuilder().newEvent(e)}initComponentTracking(e,t){this.isTrackingAllowed&&n.default.initComponentTracking(e,t)}initProductTracking(e,t){this.isTrackingAllowed&&n.default.api.initProductTracking(e,n.default.api.getCurrentPageIndex(),t)}}var a=r;t.default=a}.apply(t,i))||(e.exports=o)},613:function(t){"use strict";t.exports=e},412:function(e){"use strict";e.exports=t},571:function(e){"use strict";e.exports=n},485:function(e){"use strict";e.exports=i},986:function(e){"use strict";e.exports=o},552:function(e){"use strict";e.exports=r}},c={},function e(t){var n=c[t];if(void 0!==n)return n.exports;var i=c[t]={exports:{}};return a[t](i,i.exports,e),i.exports}(664);var a,c}));